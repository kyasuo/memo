package explorer;

import java.io.File;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.TreeMap;

import org.apache.commons.io.FileUtils;
import org.apache.commons.lang3.StringUtils;
import org.dom4j.DocumentException;
import org.dom4j.Element;
import org.dom4j.Node;
import org.dom4j.io.SAXReader;

public class SqlAnalyzer {

	static final File BASE_DIR = new File("");

	public static void main(String[] args) throws DocumentException {

		// parse
		final SAXReader reader = new SAXReader();
		final Map<String, SqlInfo> sqlMapInfo = new TreeMap<String, SqlInfo>();
		for (File xml : FileUtils.listFiles(BASE_DIR, new String[] { "xml" }, true)) {
			final String fileName = xml.getName();
			if (!fileName.endsWith("_sqlMap.xml")) {
				continue;
			}
			for (Node node : reader.read(xml).selectNodes("/sqlMap/*[@id!='']")) {
				Element element = (Element) node;
				SqlInfo sqlInfo = new SqlInfo(fileName);
				sqlMapInfo.put(element.attributeValue("id"), sqlInfo);
				// search keywords
			}
		}

		// output
		List<String> lines = new ArrayList<String>();
		for (Entry<String, SqlInfo> e : sqlMapInfo.entrySet()) {
			String sqlId = e.getKey();
			SqlInfo info = e.getValue();
			lines.add(StringUtils.join(new Object[] { info.getFileName(), sqlId, info.isSequence(), info.isRownum() },
			        ","));
		}
		System.out.println(StringUtils.join(lines, "\r\n"));
	}

	public static class SqlInfo {
		private final String fileName;
		private boolean sequence = false;
		private boolean rownum = false;

		public SqlInfo(String fileName) {
			this.fileName = fileName;
		}

		public boolean isSequence() {
			return sequence;
		}

		public void setSequence(boolean sequence) {
			this.sequence = sequence;
		}

		public boolean isRownum() {
			return rownum;
		}

		public void setRownum(boolean rownum) {
			this.rownum = rownum;
		}

		public String getFileName() {
			return fileName;
		}
	}

}
